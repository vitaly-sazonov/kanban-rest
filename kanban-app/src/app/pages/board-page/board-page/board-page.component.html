<h1>Board</h1>
<h2>ID: {{ id }}</h2>
<h3 *ngIf="isLoading$ | async">{{ 'LOADING' | translate }}</h3>
<mat-spinner
  diameter="30"
  color="primary"
  *ngIf="isLoading$ | async"></mat-spinner>
<section class="column-wrapper" cdkDropListGroup>
  <section
    class="columns"
    *ngIf="
      (currentBoard$ | async) &&
      (currentBoard$ | async)!.columns &&
      (currentBoard$ | async)!.columns!.length > 0
    ">
    <article
      class="column"
      *ngFor="let item of (currentBoard$ | async)!.columns">
      <mat-accordion class="column-accordion" togglePosition="before">
        <mat-expansion-panel class="column-inner" expanded>
          <mat-expansion-panel-header>
            <mat-panel-title class="column-title">
              {{ item.title }}
            </mat-panel-title>
            <button
              mat-icon-button
              [matMenuTriggerFor]="menu"
              (click)="toggleColumnOptions($event)">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menu="matMenu">
              <button
                mat-menu-item
                (click)="editColumn(item.id!, item.order!, item.title)">
                <mat-icon>edit</mat-icon>
                <span>{{ 'BOARD.editColumn' | translate }}</span>
              </button>
              <button mat-menu-item (click)="removeColumn(item.id!)">
                <mat-icon>delete</mat-icon>
                <span>{{ 'BOARD.removeColumn' | translate }}</span>
              </button>
            </mat-menu>
          </mat-expansion-panel-header>
          <section
            class="task-list"
            *ngIf="item.tasks"
            [cdkDropListData]="item.tasks"
            (mousedown)="recordPreviousTaskData(item.id!)"
            (cdkDropListDropped)="dropTask($event, item.id!)"
            cdkDropList>
            <div *ngIf="!item.tasks.length" class="task-item-blank" cdkDrag>
              <div class="drag-placeholder" *cdkDragPlaceholder></div>
              <span>{{ 'BOARD.noTasks' | translate }}</span>
            </div>
            <mat-card
              *ngFor="let taskItem of item.tasks"
              class="task-item"
              cdkDrag>
              <div class="drag-placeholder" *cdkDragPlaceholder></div>
              <section class="task-actions">
                <button
                  mat-icon-button
                  class="task-action-button"
                  (click)="
                    editTask(taskItem.id!, item.id!, taskItem.order!, {
                      title: taskItem.title,
                      description: taskItem.description!
                    })
                  ">
                  <mat-icon class="task-action-icon">edit</mat-icon>
                </button>
                <button
                  mat-icon-button
                  class="task-action-button"
                  (click)="removeTask(taskItem.id!, item.id!)">
                  <mat-icon class="task-action-icon">delete</mat-icon>
                </button>
              </section>
              <mat-card-title class="task-title noselect">
                {{ taskItem.title }}
              </mat-card-title>
              <mat-card-subtitle class="task-description noselect">
                {{ taskItem.description }}
              </mat-card-subtitle>
            </mat-card>
          </section>
          <mat-action-row>
            <button
              mat-stroked-button
              color="primary"
              (click)="addTask(item.id!)">
              <mat-icon class="icon-button">playlist_add</mat-icon
              >{{ 'BOARD.addTask' | translate }}
            </button>
          </mat-action-row>
        </mat-expansion-panel>
      </mat-accordion>
    </article>
  </section>
  <button class="add-column" (click)="createColumn()">
    {{ 'BOARD.addNewColumn' | translate }}
  </button>
</section>
<button [routerLink]="['../../main']">BACK to BOARDS</button>
